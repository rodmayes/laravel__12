import{s as $}from"./index-ChJKIlCL.js";import{_ as I}from"./AppLayout-Bl-vab2g.js";import{Q as A,r as h,a as k,o as B,c,b,d as a,w as s,u as o,e as n,t as m,n as M,f as g,g as R,F as V,h as z,N as F}from"./app-Cxz8kPVe.js";import{s as _}from"./index-tTgwqWQu.js";import{f as x}from"./useFormatters-DgKqr0j9.js";import{l as J}from"./loadToast-BmxbEe_F.js";import{p as L}from"./lodash-C8ehyM8K.js";import{s as O,a as l}from"./index-DKoNZaGB.js";import"./index-BGeYvXUX.js";import"./DropdownLink-DAhIJGaX.js";import"./index-BDd8EV_O.js";import"./index-oCGvJJos.js";import"./index-DywEHISW.js";import"./index-BpllR3yN.js";import"./index-CimEelRQ.js";import"./index-WfSVfh0v.js";import"./index-C-D5iXqe.js";import"./index-J0zXWw-N.js";import"./index-B7cmCZ4f.js";import"./index-9Xaz2Oaa.js";import"./index-CrDboz2d.js";import"./index-Cgv2F6jj.js";import"./index-DvNqkBAG.js";import"./index-DUJJHCqo.js";const U={key:0},T=["href"],E={key:1},Q={key:2,class:"text-gray-400 italic"},Y={class:"flex items-center gap-4"},q={key:0},ve={__name:"Index",props:{title:String,perPage:Number,filters:Object},setup(C){var v;const{pickBy:P}=L;J();const y=C;A();const j=h([{label:"Admin"},{label:y.title,url:route("admin.jobs.index")}]),r=k({params:{search:(v=y.filters)==null?void 0:v.search,perPage:y.perPage??20,model:null,status:null,executed:null,page:1,sort:[{field:"available_at",order:"asc"}]},job:null}),d=k([]),u=()=>{const i=P(r.params);z.post(route("admin.jobs.refreshData"),i).then(t=>{Object.assign(d,t.data.items)})},w=i=>{r.params.page=i.page+1,r.params.perPage=i.rows,u()},N=i=>{var f;const t=(f=i.multiSortMeta)==null?void 0:f.map(e=>({field:e.field,order:e.order===1?"asc":"desc"}));r.params.sort=t,u()},D=()=>u();B(()=>{u()});const p=h(!1),S=()=>{p.value=!1,F.delete(route("admin.jobs.delete",r.job.id),{onSuccess:()=>{p.value=!1,u()}})};return(i,t)=>{const f=$;return b(),c(V,null,[a(I,{items:j.value},{default:s(()=>[a(o(O),{value:d.data,lazy:"",paginator:"",rows:d.per_page,totalRecords:d.total,first:(d.current_page-1)*d.per_page,rowsPerPageOptions:[5,10,20,50],sortMode:"multiple",onPage:w,onSort:N,tableStyle:"min-width: 50rem",size:"small"},{paginatorstart:s(()=>[a(o(_),{type:"button",icon:"pi pi-refresh",text:"",onClick:D})]),empty:s(()=>t[2]||(t[2]=[g(" No data found. ")])),loading:s(()=>t[3]||(t[3]=[g(" Loading data. Please wait. ")])),default:s(()=>[a(o(l),{field:"id",header:"ID",sortable:""}),a(o(l),{field:"type",header:"Job",sortable:""}),a(o(l),{field:"bookingId",header:"Model ID",sortable:""},{body:s(({data:e})=>[e.type==="LaunchPrebookingJob"?(b(),c("span",U,[n("a",{class:"text",href:i.route("playtomic.bookings.edit",e.details.booking.id),target:"_blank"},m(e.details.booking.name),9,T)])):e.type==="UserLoginJob"?(b(),c("span",E,m(e.details.user.email),1)):(b(),c("span",Q,"N/A"))]),_:1}),a(o(l),{field:"reserved_at",header:"Status",sortable:""},{body:s(({data:e})=>[n("span",{class:M(e.reserved_at?"text-blue-500":"text-orange-500")},m(e.reserved_at?"Processed":"Pending"),3)]),_:1}),a(o(l),{field:"available_at",header:"Scheduled at",sortable:""},{body:s(({data:e})=>[n("span",null,m(o(x)(e.available_at)),1)]),_:1}),a(o(l),{field:"attempts",header:"Intent",sortable:""}),a(o(l),{field:"created_at",header:"Created",sortable:""},{body:s(({data:e})=>[n("span",null,m(o(x)(e.created_at)),1)]),_:1}),a(o(l),{header:"Action"},{body:s(e=>[a(o(_),{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:G=>{p.value=!0,r.job=e.data}},null,8,["onClick"])]),_:1})]),_:1},8,["value","rows","totalRecords","first"])]),_:1},8,["items"]),a(f,{visible:p.value,"onUpdate:visible":t[1]||(t[1]=e=>p.value=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:s(()=>[a(o(_),{label:"No",icon:"pi pi-times",text:"",onClick:t[0]||(t[0]=e=>p.value=!1)}),a(o(_),{label:"Yes",icon:"pi pi-check",onClick:S})]),default:s(()=>[n("div",Y,[t[6]||(t[6]=n("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1)),r.job?(b(),c("span",q,[t[4]||(t[4]=g("Are you sure you want to delete ")),n("b",null,m(r.job.type),1),t[5]||(t[5]=g("?"))])):R("",!0)])]),_:1},8,["visible"])],64)}}};export{ve as default};
