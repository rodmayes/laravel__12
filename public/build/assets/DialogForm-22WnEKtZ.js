import{s as E}from"./index-C4lvvraB.js";import{s as F}from"./index-BMoRl1xm.js";import{s as L}from"./index-ByyraLLP.js";import{s as P}from"./index-ChyoiKwM.js";import{s as D}from"./index-JehCiGv6.js";import{s as I}from"./index-DtIMjM1X.js";import{T as M,r as $,Y as T,i as H,b as f,w as k,e as i,c as y,g as h,d as c,u as r,t as _,F as q,M as O}from"./app-BitM9Esh.js";import"./index-BoR1qmRO.js";import"./index-CyWtV5jm.js";import"./index-DYoa0sVQ.js";import"./index-3G90EgRb.js";import"./index-eTxTr7Xb.js";const Y={class:"mb-4"},z={key:0,class:"text-red-500"},G={class:"mb-4"},J={class:"mb-4"},K={key:0,class:"text-red-500"},Q={key:0,class:"mb-4"},R={class:"mb-4"},W={class:"flex gap-2"},X={key:0,class:"text-red-500"},Z={class:"mb-4"},ee={key:0,class:"text-red-500"},ce={__name:"DialogForm",props:{visible:Boolean,availableCommands:Array,job:Object,isEditing:Boolean},emits:["update:visible","refresh"],setup(w,{emit:C}){const u=w,V=C,t=M({command:"",parameters:[],scheduled_for:null,time:null,active:!0}),o={type:$("daily"),hour:$(0),minute:$(0)},j=[{label:"Cada x minutos",value:"every-x-minutes"},{label:"Diario",value:"daily"},{label:"Semanal",value:"weekly"},{label:"Mensual",value:"monthly"},{label:"Anual",value:"yearly"},{label:"Primer dÃ­a del mes",value:"first-of-month"},{label:"Primer lunes del mes",value:"first-monday-of-month"}],S=m=>{const[e,d,a,l,v]=m.trim().split(/\s+/),p=n=>n==="*",b=n=>/^\d+$/.test(n),s=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];return a==="1-7"&&p(l)&&b(v)?`first_${s[+v]}_of_month`:a==="1"&&p(l)&&p(v)?"first_day_of_month":/L$/.test(a)?"last_day_of_month":(/\*\/3/.test(l)||/\.?\/3/.test(l))&&b(a)?"quarterly":b(l)&&b(a)&&p(v)?"annually":p(l)&&b(a)&&p(v)?"monthly":p(a)&&p(l)&&p(v)?"daily":null},N=({type:m,hour:e,minute:d})=>{const a=Number(e??0),l=Number(d??0);switch(m){case"every-minute":return"* * * * *";case"every-x-minutes":return`*/${l} * * * *`;case"daily":return`${l} ${a} * * *`;case"weekly":return`${l} ${a} * * 1`;case"monthly":return`${l} ${a} 1 * *`;case"yearly":return`${l} ${a} 1 1 *`;case"first-of-month":return`${l} ${a} 1 * *`;case"first-monday-of-month":return`${l} ${a} 1-7 * 1`;default:return""}},x=m=>String(m).padStart(2,"0");T(()=>u.visible,m=>{var e;if(t.errors={},m&&u.job){t.command=u.job.command,t.parameters=u.job.parameters||[],t.active=u.job.active;const d=((e=u.job.scheduled_for)==null?void 0:e.trim())??"";if(o.type.value=S(d),d){const a=d.split(" ");if(a.length===5){const[l,v]=a;o.hour.value=Number(v)||0,o.minute.value=Number(l)||0}}}else t.reset(),o.type.value="daily",o.hour.value=0,o.minute.value=0});const U=()=>t.parameters.push(""),B=m=>t.parameters.splice(m,1),A=()=>{t.time=`${x(o.hour.value)}:${x(o.minute.value)}`,t.scheduled_for=N({type:o.type.value,hour:o.hour.value,minute:o.minute.value});const m=u.isEditing?"put":"post",e=u.isEditing?route("scheduled-job-commands.update",u.job.id):route("scheduled-job-commands.store");t[m](e,{onSuccess:()=>{V("refresh"),V("update:visible",!1)}})};return(m,e)=>{const d=I,a=D,l=P,v=L,p=F,b=E;return f(),H(b,{visible:u.visible,"onUpdate:visible":e[7]||(e[7]=s=>u.visible=s),modal:"",header:"Programmer command",style:{width:"500px"}},{footer:k(()=>[c(l,{label:"Cancel",text:"",onClick:e[6]||(e[6]=s=>V("update:visible",!1))}),c(l,{label:"Save",icon:"pi pi-check",onClick:A})]),default:k(()=>[i("div",Y,[e[8]||(e[8]=i("label",{for:"command"},"Command",-1)),c(d,{modelValue:r(t).command,"onUpdate:modelValue":e[0]||(e[0]=s=>r(t).command=s),options:u.availableCommands,filter:"",placeholder:"Select command",class:"w-full",optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"]),r(t).errors.command?(f(),y("small",z,_(r(t).errors.command),1)):h("",!0)]),i("div",G,[e[9]||(e[9]=i("label",null,"Parameters",-1)),(f(!0),y(q,null,O(r(t).parameters,(s,n)=>(f(),y("div",{key:n,class:"flex items-center gap-2 mb-1"},[c(a,{modelValue:r(t).parameters[n],"onUpdate:modelValue":g=>r(t).parameters[n]=g,class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),c(l,{icon:"pi pi-times",text:"",onClick:g=>B(n)},null,8,["onClick"])]))),128)),c(l,{icon:"pi pi-plus",label:"Add parameter",text:"",onClick:U})]),i("div",J,[e[10]||(e[10]=i("label",null,"Frecuencia",-1)),c(d,{modelValue:o.type.value,"onUpdate:modelValue":e[1]||(e[1]=s=>o.type.value=s),options:j,placeholder:"Frecuencia",class:"w-full",optionLabel:"label",optionValue:"value"},null,8,["modelValue"]),r(t).errors.scheduled_for?(f(),y("small",K,_(r(t).errors.scheduled_for),1)):h("",!0)]),o.type.value==="every-x-minutes"?(f(),y("div",Q,[e[11]||(e[11]=i("label",null,"Every x minutes",-1)),c(v,{modelValue:o.minute.value,"onUpdate:modelValue":e[2]||(e[2]=s=>o.minute.value=s),min:1,max:59,class:"w-full"},null,8,["modelValue"])])):h("",!0),i("div",R,[e[12]||(e[12]=i("label",null,"Hora",-1)),i("div",W,[c(d,{modelValue:o.hour.value,"onUpdate:modelValue":e[3]||(e[3]=s=>o.hour.value=s),options:Array.from({length:24},(s,n)=>n),class:"w-full",placeholder:"Hora"},null,8,["modelValue","options"]),c(d,{modelValue:o.minute.value,"onUpdate:modelValue":e[4]||(e[4]=s=>o.minute.value=s),options:Array.from({length:60},(s,n)=>n),class:"w-full",placeholder:"Minuto"},null,8,["modelValue","options"]),r(t).errors.name?(f(),y("small",X,_(r(t).errors.name),1)):h("",!0)])]),i("div",Z,[e[13]||(e[13]=i("label",null,"Status",-1)),c(p,{modelValue:r(t).active,"onUpdate:modelValue":e[5]||(e[5]=s=>r(t).active=s),onLabel:"Active",offLabel:"Inactive",class:"mb-3"},null,8,["modelValue"]),r(t).errors.naactiveme?(f(),y("small",ee,_(r(t).errors.active),1)):h("",!0)])]),_:1},8,["visible"])}}};export{ce as default};
